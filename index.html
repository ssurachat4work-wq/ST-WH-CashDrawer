<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÉ‡∏ö‡∏ô‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î (Cash Drawer)</title>
    
    <!-- 1. ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Tailwind CSS (‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ React (‡∏™‡∏°‡∏≠‡∏á) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤ (Babel) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏•‡∏á HTML ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (html2canvas) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        
        /* ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏•‡∏á‡πÉ‡∏ô Input type number */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 1. ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ ---
        const IconPrinter = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>;
        const IconRefresh = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg>;
        const IconCopy = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>;
        const IconCheck = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>;
        const IconExcel = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="M8 13h2"></path><path d="M8 17h2"></path><path d="M14 13h2"></path><path d="M14 17h2"></path></svg>;
        const IconImage = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>;

        // --- 2. Component ‡πÅ‡∏ñ‡∏ß‡∏ô‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô ---
        const DenomRow = ({ label, qtyName, qtyValue, amount, onChange, formatCurrency }) => (
            <div className="grid grid-cols-12 gap-2 items-center py-1 border-b border-gray-100 text-sm">
                <div className="col-span-3 font-semibold text-gray-700">{label}</div>
                <div className="col-span-4">
                    <input 
                        type="number" 
                        name={qtyName} 
                        value={qtyValue} 
                        onChange={onChange} 
                        placeholder="0" 
                        className="w-full p-1 border border-gray-300 rounded text-center focus:border-blue-500 outline-none" 
                    />
                </div>
                <div className="col-span-5 text-right font-mono text-gray-900 bg-gray-50 p-1 rounded">
                    {formatCurrency(amount)}
                </div>
            </div>
        );

        // --- 3. ‡∏ï‡∏±‡∏ß‡πÅ‡∏≠‡∏õ‡∏´‡∏•‡∏±‡∏Å ---
        function App() {
            const [formData, setFormData] = useState({
                branch: '', fix: '', 
                date: new Date().toISOString().split('T')[0],
                time: new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' }),
                returnWrongKey: '', totalSale: '', creditCard: '', debit: '', wechat: '', alipay: '', alipayPlus: '',
                qty1000: '', qty500: '', qty100: '', qty50: '', qty20: '', 
                qty10: '', qty5: '', qty2: '', qty1: '', 
                cashPos: '', recipient: '', note: ''
            });

            const [calculations, setCalculations] = useState({ totalCashReal: 0, overShort: 0, breakdown: {} });
            const [copied, setCopied] = useState(false);
            const [isGeneratingImg, setIsGeneratingImg] = useState(false);

            useEffect(() => {
                const parse = (val) => parseFloat(val) || 0;
                const breakdown = {
                    amt1000: parse(formData.qty1000) * 1000,
                    amt500: parse(formData.qty500) * 500,
                    amt100: parse(formData.qty100) * 100,
                    amt50: parse(formData.qty50) * 50,
                    amt20: parse(formData.qty20) * 20,
                    amt10: parse(formData.qty10) * 10,
                    amt5: parse(formData.qty5) * 5,
                    amt2: parse(formData.qty2) * 2,
                    amt1: parse(formData.qty1) * 1,
                };
                const totalCashReal = Object.values(breakdown).reduce((a, b) => a + b, 0);
                const cashPos = parse(formData.cashPos);
                const overShort = cashPos ? totalCashReal - cashPos : 0;
                setCalculations({ totalCashReal, overShort, breakdown });
            }, [formData]);

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handlePrint = () => window.print();

            const handleSaveImage = async () => {
                setIsGeneratingImg(true);
                // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏õ‡πä‡∏ö‡∏ô‡∏∂‡∏á
                setTimeout(async () => {
                    try {
                        const element = document.getElementById('printable-area');
                        const canvas = await html2canvas(element, {
                            scale: 2, // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏û 2 ‡πÄ‡∏ó‡πà‡∏≤
                            backgroundColor: "#ffffff", // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß
                            logging: false
                        });
                        
                        const link = document.createElement('a');
                        link.download = `CashReport_${formData.date}_${formData.branch.replace(/\s+/g, '_')}.png`;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    } catch (err) {
                        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û: " + err);
                    }
                    setIsGeneratingImg(false);
                }, 100);
            };

            const handleExportCSV = () => {
                const bom = "\uFEFF"; 
                const csvContent = [
                    ["Branch", formData.branch], ["Date", formData.date], ["Time", formData.time],
                    ["--- Sales ---"], ["Total Sale", formData.totalSale], ["Cash POS", formData.cashPos],
                    ["--- Counts (Bills) ---"], 
                    ["1000", formData.qty1000], ["500", formData.qty500], ["100", formData.qty100], ["50", formData.qty50], ["20", formData.qty20],
                    ["--- Counts (Coins) ---"],
                    ["10", formData.qty10], ["5", formData.qty5], ["2", formData.qty2], ["1", formData.qty1],
                    ["Total Cash Real", calculations.totalCashReal], ["Over/Short", calculations.overShort],
                    ["Note", formData.note]
                ].map(e => e.join(",")).join("\n");
                
                const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = `CashReport_${formData.date}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleCopyText = () => {
                const text = `üõí *Cash Report*\nüìç ${formData.branch} (${formData.date})\nüí∞ Sale: ${formData.totalSale}\nüíµ Real: ${calculations.totalCashReal}\nüñ• POS: ${formData.cashPos}\n${calculations.overShort > 0 ? '‚úÖ Over: +' : '‚ùå Short: '}${calculations.overShort}\nüìù ${formData.note}`;
                navigator.clipboard.writeText(text);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const handleReset = () => {
                if(window.confirm("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) setFormData({ ...formData, qty1000: '', qty500: '', qty100: '', qty50: '', qty20: '', qty10: '', qty5: ‡∏°
